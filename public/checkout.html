<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checkout</title>
    <link rel="stylesheet" href="{{ asset('css/style3.css') }}">
    <script src="https://kit.fontawesome.com/26f8ed069f.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>

<div class="product-container">
    <div class="details">
        <h1 class="cost">Secure Payments</h1>
        <h3 class="title">KicksKorner</h3>
    </div>
</div>

<div id="cartItems" class="checkout-container">
    
</div>

<div class="container">
    <p class="total-cost">Total Cost: $<span id="totalCost">0.00</span></p>
    <button class="purchase-button" data-content="PURCHASE">PURCHASE</button>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    displayCartItems();
});

function displayCartItems() {
    let carts = JSON.parse(localStorage.getItem('cart')) || [];
    let totalCost = 0;

    carts.forEach(function(cartItem) {
        
        let cartItemDiv = document.createElement('div');
        cartItemDiv.classList.add('cart-item');

        
        let cartItemDetails = document.createElement('p');
        cartItemDetails.textContent = `${cartItem.name} - $${cartItem.price} x ${cartItem.quantity}`;

        
        cartItemDiv.appendChild(cartItemDetails);

        
        document.getElementById('cartItems').appendChild(cartItemDiv);

        totalCost += cartItem.price * cartItem.quantity;
    });

    
    document.getElementById('totalCost').textContent = totalCost.toFixed(2);
}

document.querySelector('.purchase-button').addEventListener('click', function() {
    processCheckout();
});

function processCheckout() {
    let carts = JSON.parse(localStorage.getItem('cart')) || [];
    fetch('/checkout', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({carts})
    })
    .then(response => response.json())
    .then(data => {
        alert(`Your order number is: ${data.orderNumber}`);
        localStorage.removeItem('cart');
        
    })
    .catch(error => {
        console.error('Checkout error:', error);
        alert('Checkout failed. Please try again.');
    });
}
</script>

</body>
</html>
